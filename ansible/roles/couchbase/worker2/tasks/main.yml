---
- name: join couchbase cluster
  shell: ./couchbase-cli server-add -c {{ hostvars['worker1'].private_ip}}:8091 --username Administrator --password password --server-add http://{{ hostvars['worker2'].private_ip}}:8091 --server-add-username someName --server-add-password somePassword --services data,index,query
  args:
    chdir: /opt/couchbase/bin

- name: rebalance couchbase cluster
  shell: ./couchbase-cli  rebalance -c {{ hostvars['worker1'].private_ip}}:8091 --username Administrator --password password
  args:
    chdir: /opt/couchbase/bin

- name: create testBucket testBucket
  shell: ./couchbase-cli bucket-create --cluster {{ hostvars['worker1'].private_ip }}:8091 --username Administrator --password password --bucket testBucket --bucket-type couchbase --bucket-ramsize 512 --durability-min-level persistToMajority --enable-flush 0
  args:
    chdir: /opt/couchbase/bin
